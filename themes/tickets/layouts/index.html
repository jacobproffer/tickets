{{ define "main" }}

{{ $startYear := 2007 }}
{{ $currentYear := now.Format "2006" }}
{{ $totalYears := sub (int $currentYear) $startYear }}
{{ $currentYearMovies := 0 }}
{{ $totalSpent := 0.00 }}
{{ $theaters := slice }}
{{ $totalTickets := len .Site.Data.movies }}

{{ range .Site.Data.movies }}

  {{ $totalSpent = add $totalSpent (float .Price) }}

  {{ if eq ( dateFormat "2006" .Date ) $currentYear }}
    {{ $currentYearMovies = add $currentYearMovies 1 }}
  {{ end }}

  {{ $theaters = $theaters | append (string .Theater) | uniq }}

{{ end }}

<section class="hero grid">

  <div class="hero__left center-content light-gray-background">
    <span class="hero__barcode barcode" aria-hidden="true">This is a Test</span>
  </div>

  <div class="hero__center gray-background center">

    <span>{{ .Site.Params.subTitle }}</span>

    <header>
      <h1>{{ .Title }}</h1>
    </header>

    <dl class="hero__stats grid">
      <div class="gray-background">
        <dt>Years</dt>
        <dd class="h2">{{ $totalYears }}</dd>
      </div>
      <div class="gray-background">
        <dt>Theaters</dt>
        <dd class="h2">{{ len $theaters }}</dd>
      </div>
      <div class="gray-background">
        <dt>Tickets</dt>
        <dd class="h2">{{ $totalTickets }}</dd>
      </div>
    </dl>

  </div>

  <div class="hero__right center-content light-gray-background">
    <span aria-hidden="true">Admit One</span>
  </div>

</section>

<section>

  <header class="visually-hide">
    <h2 id="ticket-list">Tickets Collected</h2>
  </header>

  <ul class="unstyled-list grid ticket-list" aria-labelledby="ticket-list">

    {{ range sort .Site.Data.movies "Date" "desc" }}

      <li class="ticket border-bottom">

        {{ partial "ticket.html" . }}

      </li>

    {{ end }}

  </ul>

</section>

<section class="intro gray-background border-bottom">

  <div class="intro__container">
    <header>
      <h2>An Unexpected Collection</h2>
    </header>

    <p>In {{ $startYear }}, I started to collect movie tickets as mementos for a personal relationship. For each date to the theater, I'd place the ticket in a plastic cup with the words, "Dead Man's Brew", printed on the side. Even though the relationship ended over a decade ago, I've continued to fill the cup each year. It is nearly full with {{ $totalTickets }} tickets. For the current year, {{ $currentYear }}, I've collected {{ $currentYearMovies }} tickets. To date, I've spent at least ${{ $totalSpent | lang.NumFmt 2 }} on movie tickets.</p>
  </div>

</section>

{{ end }}
