{{ define "main" }}

{{ $currentYear := now.Format "2006" }}
{{ $currentYearMovies := 0 }}

{{ range .Site.Data.movies }}
  {{ if eq ( dateFormat "2006" .Date ) $currentYear }}
    {{ $currentYearMovies = add $currentYearMovies 1 }}
  {{ end }}
{{ end }}

<section class="tickets" id="content">
  <div class="tickets__hero grid">
    <div class="tickets__left"></div>
    <div class="tickets__grid">
      <span class="center">A Movie Ticket Collection</span>
      <header class="tickets__header center">
        <h1 id="ticket-list">Dead Man's Brew</h1>
      </header>
      <ul class="tickets__stats grid unstyled-list">
        <li class="tickets__years center">
          <span class="h2">13</span class="h2">
          Years
        </li>
        <li class="tickets__theaters">
          <span class="h2">7</span>
          Theaters Visited
        </li>
        <li class="tickets__total">
          <span class="h2">{{ len .Site.Data.movies }}</span>
          Tickets Collected
        </li>
        <li class="tickets__statement">
          <span class="h2">Background</span>
          <p>In 2007, I started to collect movie tickets in a cheap plastic cup with the words, "Dead Man's Brew", printed on the side.</p>
        </li>
      </ul>
    </div>
    <div class="tickets__right center-content">
      <span>Admit One</span>
    </div>
  </div>

  <ul class="unstyled-list grid grid--three-column tickets__list" aria-labelledby="ticket-list">

    {{ $class := "" }}

    {{ range sort .Site.Data.movies "Date" "desc" }}

      {{ if .Unique }}
        {{ $class = "ticket ticket--special" }}
      {{ else }}
        {{ $class = "ticket" }}
      {{ end }}

      <li class="{{ $class }}">

        <article>

          {{ if eq .Theater "Thomas Theatre Group" }}
            <div class="ticket__background ticket__background--circle"></div>
          {{ else if eq .Theater "Carmike Cinemas" }}
            <div class="ticket__background ticket__background--triangle"></div>
          {{ else }}
            <div class="ticket__background ticket__background--default"></div>
          {{ end }}

          <small>{{ .Theater }}<br /> Presenting</small>
          <header>
            <h3>{{ .Title }}</h3>
          </header>
          <ul class="unstyled-list">
            <li>
              <time class="ticket__time" datetime="{{ .Date }}">
                {{ dateFormat "Mon 01/02/2006" .Date }}
              </time>
            </li>
            <li>
              <small class="ticket__price">{{ .Price }}</small>
            </li>
            <li>
              <span class="ticket__rating">{{ .Rating }}</span>
            </li>
            <li>
              <span class="ticket__barcode barcode" aria-hidden="true">{{ .Genre }}</span>
            </li>
            <li>
              <small class="ticket__unix" aria-hidden="true">{{ mul 1000 (time .Date).Unix }}</small>
            </li>
          </ul>

        </article>

      </li>

    {{ end }}

  </ul>

</section>

{{ end }}
