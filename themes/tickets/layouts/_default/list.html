{{ define "main" }}

{{ $currentYear := now.Format "2006" }}
{{ $currentYearMovies := 0 }}

{{ range .Site.Data.movies }}
  {{ if eq ( dateFormat "2006" .Date ) $currentYear }}
    {{ $currentYearMovies = add $currentYearMovies 1 }}
  {{ end }}
{{ end }}

<section class="tickets" id="content">
  <header class="full-height center-content tickets__header">
    <h1 id="ticket-list">Tickets</h1>
  </header>

  <!-- <div class="full-height center-content tickets__count">
    <h2>Number of tickets: {{ len .Site.Data.movies }}</h2>
  </div> -->

  {{/*  <span>Movies watched in {{ $currentYear }}: {{ $currentYearMovies }}</span>  */}}

  <ul class="unstyled-list grid grid--three-column tickets__list" aria-labelledby="ticket-list">

    {{ $class := "" }}

    {{ range sort .Site.Data.movies "Date" "desc" }}

      {{ if .Unique }}
        {{ $class = "ticket ticket--special" }}
      {{ else }}
        {{ $class = "ticket" }}
      {{ end }}

      <li class="{{ $class }}">

        {{ if eq .Theater "Thomas Theatre Group" }}
          <div class="ticket__background ticket__background--circle"></div>
        {{ else if eq .Theater "Carmike Cinemas" }}
          <div class="ticket__background ticket__background--triangle"></div>
        {{ else }}
          <div class="ticket__background ticket__background--default"></div>
        {{ end }}

        <small>{{ .Theater }}<br /> Presenting</small>
        <header>
          <h3>{{ .Title }}</h3>
        </header>
        <time class="ticket__time" datetime="{{ .Date }}">
          {{ dateFormat "Mon 01/02/2006" .Date }}
        </time>
        {{ if .Price }}
          <small class="ticket__price">{{ .Price }}</small>
        {{ end }}
        <span class="ticket__rating">{{ .Rating }}</span>
        <span class="ticket__barcode" aria-hidden="true">{{ .Genre }}</span>
        <small class="ticket__unix" aria-hidden="true">{{ mul 1000 (time .Date).Unix }}</small>
      </li>

    {{ end }}

  </ul>

</section>

{{ end }}
